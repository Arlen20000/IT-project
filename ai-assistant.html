<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Assistant - TechFlow Solutions</title>
  <meta name="description" content="Get instant answers to your IT questions with our AI assistant. Learn about our services, pricing, and how we can help your business.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles/global.css">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#2563eb">
  <style>
    /* AI Assistant specific styles */
    .ai-hero {
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-hover) 100%);
      color: white;
      padding: 4rem 0;
      text-align: center;
    }

    .chat-container {
      max-width: 800px;
      margin: 2rem auto;
      background: var(--bg-primary);
      border-radius: 1rem;
      box-shadow: var(--shadow-lg);
      overflow: hidden;
      border: 1px solid var(--border-color);
    }

    .chat-header {
      background: var(--bg-secondary);
      padding: 1rem 1.5rem;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .ai-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--primary-color);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
    }

    .chat-messages {
      height: 400px;
      overflow-y: auto;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .message {
      display: flex;
      gap: 0.75rem;
      max-width: 80%;
      animation: slideIn 0.3s ease;
    }

    .message.user {
      align-self: flex-end;
      flex-direction: row-reverse;
    }

    .message-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.875rem;
      flex-shrink: 0;
    }

    .message.user .message-avatar {
      background: var(--primary-color);
      color: white;
    }

    .message.ai .message-avatar {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .message-content {
      background: var(--bg-secondary);
      padding: 0.75rem 1rem;
      border-radius: 1rem;
      position: relative;
    }

    .message.user .message-content {
      background: var(--primary-color);
      color: white;
    }

    .message-timestamp {
      font-size: 0.75rem;
      color: var(--text-secondary);
      margin-top: 0.25rem;
    }

    .message.user .message-timestamp {
      text-align: right;
      color: rgba(255, 255, 255, 0.7);
    }

    .chat-input-area {
      border-top: 1px solid var(--border-color);
      padding: 1rem 1.5rem;
      display: flex;
      gap: 0.75rem;
      align-items: flex-end;
    }

    .chat-input {
      flex: 1;
      padding: 0.75rem 1rem;
      border: 1px solid var(--border-color);
      border-radius: 0.5rem;
      resize: none;
      font-family: inherit;
      min-height: 44px;
      max-height: 120px;
    }

    .chat-input:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    .send-button {
      padding: 0.75rem 1.5rem;
      background: var(--primary-color);
      color: white;
      border: none;
      border-radius: 0.5rem;
      cursor: pointer;
      transition: var(--transition);
      flex-shrink: 0;
    }

    .voice-controls {
      display: flex;
      gap: 0.25rem;
      align-items: center;
    }

    .voice-btn {
      width: 40px;
      height: 40px;
      border: 1px solid var(--border-color);
      border-radius: 0.5rem;
      background: var(--bg-secondary);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
      transition: var(--transition);
    }

    .voice-btn:hover {
      background: var(--bg-tertiary);
      transform: scale(1.05);
    }

    .voice-btn.active {
      background: var(--primary-color);
      color: white;
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .send-button:hover {
      background: var(--primary-hover);
    }

    .send-button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .typing-indicator {
      display: none;
      padding: 0.75rem 1rem;
      color: var(--text-secondary);
      font-style: italic;
    }

    .typing-indicator.active {
      display: block;
    }

    .quick-questions {
      margin: 2rem auto;
      max-width: 800px;
    }

    .quick-questions h3 {
      text-align: center;
      margin-bottom: 1.5rem;
    }

    .quick-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
    }

    .quick-btn {
      padding: 1rem;
      background: var(--bg-primary);
      border: 1px solid var(--border-color);
      border-radius: 0.5rem;
      cursor: pointer;
      transition: var(--transition);
      text-align: center;
    }

    .quick-btn:hover {
      border-color: var(--primary-color);
      background: var(--bg-secondary);
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @media (max-width: 768px) {
      .chat-container {
        margin: 1rem;
        border-radius: 0.5rem;
      }

      .chat-messages {
        height: 300px;
      }

      .quick-buttons {
        grid-template-columns: 1fr;
      }

      .message {
        max-width: 90%;
      }
    }
  </style>
</head>
<body>
  <!-- Header will be inserted here by JavaScript -->

  <main>
    <!-- AI Hero -->
    <section class="ai-hero">
      <div class="container">
        <h1 class="animate-on-scroll">AI Assistant</h1>
        <p class="animate-on-scroll">Get instant answers about our services, pricing, and how we can help your business.</p>
      </div>
    </section>

    <!-- Chat Interface -->
    <section class="section">
      <div class="container">
        <div class="chat-container">
          <div class="chat-header">
            <div class="ai-avatar">ðŸ¤–</div>
            <div>
              <h3>TechFlow AI Assistant</h3>
              <p style="margin: 0; font-size: var(--font-size-sm); color: var(--text-secondary);">Ask me anything about our IT services</p>
            </div>
          </div>

          <div class="chat-messages" id="chat-messages">
            <div class="message ai">
              <div class="message-avatar">ðŸ¤–</div>
              <div class="message-content">
                Hello! I'm your AI assistant. I can help you learn about our IT outsourcing services, pricing, portfolio, and answer any questions you have. What would you like to know?
                <div class="message-timestamp">Just now</div>
              </div>
            </div>
          </div>

          <div class="typing-indicator" id="typing-indicator">
            AI is typing...
          </div>

          <div class="chat-input-area">
            <textarea
              id="chat-input"
              class="chat-input"
              placeholder="Ask me about our services, pricing, or anything else..."
              rows="1"
            ></textarea>
            <div class="voice-controls">
              <button id="voice-input-btn" class="voice-btn" title="Voice Input">
                ðŸŽ¤
              </button>
              <button id="voice-output-btn" class="voice-btn" title="Voice Output">
                ðŸ”Š
              </button>
            </div>
            <button id="send-button" class="send-button">Send</button>
          </div>
        </div>

        <!-- Quick Questions -->
        <div class="quick-questions">
          <h3>Quick Questions</h3>
          <div class="quick-buttons">
            <button class="quick-btn" onclick="sendQuickQuestion('What services do you offer?')">What services do you offer?</button>
            <button class="quick-btn" onclick="sendQuickQuestion('How much does web development cost?')">How much does web development cost?</button>
            <button class="quick-btn" onclick="sendQuickQuestion('Tell me about your portfolio')">Tell me about your portfolio</button>
            <button class="quick-btn" onclick="sendQuickQuestion('Do you provide AI solutions?')">Do you provide AI solutions?</button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer will be inserted here by JavaScript -->

  <script src="components/header.js"></script>
  <script src="components/footer.js"></script>
  <script src="scripts/common.js"></script>
  <script>
    const chatMessages = document.getElementById('chat-messages');
    const chatInput = document.getElementById('chat-input');
    const sendButton = document.getElementById('send-button');
    const typingIndicator = document.getElementById('typing-indicator');

    // Send message
    async function sendMessage(message) {
      if (!message.trim()) return;

      // Add user message
      addMessage(message, 'user');

      // Clear input
      chatInput.value = '';
      adjustTextareaHeight();

      // Show typing indicator
      typingIndicator.classList.add('active');

      try {
        const response = await fetch('/api/ai/chat', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ message }),
        });

        const data = await response.json();

        // Hide typing indicator
        typingIndicator.classList.remove('active');

        // Add AI response
        addMessage(data.response, 'ai');

      } catch (error) {
        console.error('Error sending message:', error);
        typingIndicator.classList.remove('active');
        addMessage('Sorry, I encountered an error. Please try again later.', 'ai');
      }
    }

    // Add message to chat
    function addMessage(content, type) {
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${type}`;

      const avatar = type === 'user' ? 'ðŸ‘¤' : 'ðŸ¤–';
      const timestamp = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

      messageDiv.innerHTML = `
        <div class="message-avatar">${avatar}</div>
        <div class="message-content">
          ${content}
          <div class="message-timestamp">${timestamp}</div>
        </div>
      `;

      chatMessages.appendChild(messageDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // Send quick question
    function sendQuickQuestion(question) {
      chatInput.value = question;
      sendMessage(question);
    }

    // Adjust textarea height
    function adjustTextareaHeight() {
      chatInput.style.height = 'auto';
      chatInput.style.height = Math.min(chatInput.scrollHeight, 120) + 'px';
    }

    // Event listeners
    sendButton.addEventListener('click', () => sendMessage(chatInput.value));
    chatInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage(chatInput.value);
      }
    });
    chatInput.addEventListener('input', adjustTextareaHeight);

    // Voice interface variables
    let recognition = null;
    let speechSynthesis = window.speechSynthesis;
    let isListening = false;
    let isSpeaking = false;

    // Initialize voice interface
    function initializeVoiceInterface() {
      // Check for browser support
      if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
        console.warn('Speech recognition not supported');
        document.getElementById('voice-input-btn').style.display = 'none';
      } else {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        recognition = new SpeechRecognition();
        recognition.continuous = false;
        recognition.interimResults = false;
        recognition.lang = 'en-US';

        recognition.onstart = () => {
          isListening = true;
          voiceInputBtn.classList.add('active');
          voiceInputBtn.textContent = 'ðŸŽ™ï¸';
          addMessage('AI', 'Listening... Speak now or click the microphone again to stop.');
        };

        recognition.onresult = (event) => {
          const transcript = event.results[0][0].transcript;
          chatInput.value = transcript;
          addMessage('User', transcript);
          sendMessage(transcript);
        };

        recognition.onend = () => {
          isListening = false;
          voiceInputBtn.classList.remove('active');
          voiceInputBtn.textContent = 'ðŸŽ¤';
        };

        recognition.onerror = (event) => {
          console.error('Speech recognition error:', event.error);
          isListening = false;
          voiceInputBtn.classList.remove('active');
          voiceInputBtn.textContent = 'ðŸŽ¤';
          addMessage('AI', 'Sorry, I didn\'t catch that. Please try again or type your message.');
        };
      }

      // Voice input button
      const voiceInputBtn = document.getElementById('voice-input-btn');
      voiceInputBtn.addEventListener('click', () => {
        if (isListening) {
          recognition.stop();
        } else {
          recognition.start();
        }
      });

      // Voice output button
      const voiceOutputBtn = document.getElementById('voice-output-btn');
      voiceOutputBtn.addEventListener('click', () => {
        if (isSpeaking) {
          speechSynthesis.cancel();
          isSpeaking = false;
          voiceOutputBtn.classList.remove('active');
          voiceOutputBtn.textContent = 'ðŸ”Š';
        } else {
          // Speak the last AI message
          const messages = document.querySelectorAll('.message.ai .message-content');
          if (messages.length > 0) {
            const lastMessage = messages[messages.length - 1];
            const text = lastMessage.textContent.replace(/Just now|\d+:\d+ (AM|PM)/g, '').trim();
            speakText(text);
          }
        }
      });
    }

    // Speak text function
    function speakText(text) {
      if (!speechSynthesis) return;

      // Cancel any ongoing speech
      speechSynthesis.cancel();

      const utterance = new SpeechSynthesisUtterance(text);
      utterance.rate = 0.9;
      utterance.pitch = 1;
      utterance.volume = 0.8;

      utterance.onstart = () => {
        isSpeaking = true;
        voiceOutputBtn.classList.add('active');
        voiceOutputBtn.textContent = 'ðŸ”‡';
      };

      utterance.onend = () => {
        isSpeaking = false;
        voiceOutputBtn.classList.remove('active');
        voiceOutputBtn.textContent = 'ðŸ”Š';
      };

      utterance.onerror = () => {
        isSpeaking = false;
        voiceOutputBtn.classList.remove('active');
        voiceOutputBtn.textContent = 'ðŸ”Š';
      };

      speechSynthesis.speak(utterance);
    }

    // Modify sendMessage to include voice output
    const originalSendMessage = window.sendMessage;
    window.sendMessage = function(message) {
      if (originalSendMessage) {
        originalSendMessage(message);
      }

      // Auto-speak AI responses if voice output is enabled
      setTimeout(() => {
        if (isSpeaking) {
          const messages = document.querySelectorAll('.message.ai .message-content');
          if (messages.length > 0) {
            const lastMessage = messages[messages.length - 1];
            const text = lastMessage.textContent.replace(/Just now|\d+:\d+ (AM|PM)/g, '').trim();
            speakText(text);
          }
        }
      }, 1000);
    };

    // Insert header and footer immediately
    document.body.insertAdjacentHTML('afterbegin', window.headerHTML);
    document.body.insertAdjacentHTML('beforeend', window.footerHTML);

    // Add header styles
    const headerStyle = document.createElement('style');
    headerStyle.textContent = window.headerStyles;
    document.head.appendChild(headerStyle);

    // Add footer styles
    const footerStyle = document.createElement('style');
    footerStyle.textContent = window.footerStyles;
    document.head.appendChild(footerStyle);

    // Initialize page-specific functionality
    document.addEventListener('DOMContentLoaded', () => {
      const footerStyle = document.createElement('style');
      footerStyle.textContent = window.footerStyles;
      document.head.appendChild(footerStyle);

      // Initialize voice interface
      initializeVoiceInterface();

      // Focus on input
      chatInput.focus();
    });
  </script>
</body>
</html>